<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GoodX SSL Expiry Dashboard</title>
  <style>
    body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f8f9fa;
  color: #333;
  margin: 0;
  padding: 40px 20px;
  line-height: 1.6;
}

h1 {
  text-align: center;
  color: #003366;          /* Dark blue like GoodX */
  margin-bottom: 30px;
  font-size: 2.2em;
  font-weight: 600;
}

.refresh-btn {
  display: block;
  margin: 0 auto 30px;
  padding: 12px 30px;
  background: #0066cc;     /* GoodX-style blue */
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 1.1em;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  transition: background 0.2s;
}

.refresh-btn:hover {
  background: #0055aa;
}

table {
  width: 100%;
  max-width: 1000px;
  margin: 0 auto;
  border-collapse: collapse;
  background: white;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  border-radius: 8px;
  overflow: hidden;
}

th, td {
  padding: 16px 20px;
  text-align: left;
}

th {
  background: #0066cc;     /* Blue header like GoodX */
  color: white;
  font-weight: 600;
  text-transform: uppercase;
  font-size: 0.95em;
  letter-spacing: 0.5px;
}

td {
  border-bottom: 1px solid #eee;
}

tr:last-child td {
  border-bottom: none;
}

a {
  color: #0066cc;
  text-decoration: none;
  font-weight: 500;
}

a:hover {
  text-decoration: underline;
}

.status-ok    { color: #28a745; font-weight: bold; }
.status-warning { color: #fd7e14; font-weight: bold; }
.status-danger  { color: #dc3545; font-weight: bold; }

.refresh-time {
  text-align: center;
  margin-top: 30px;
  color: #6c757d;
  font-size: 0.95em;
}

@media (max-width: 768px) {
  th, td { padding: 12px 15px; }
  h1 { font-size: 1.8em; }
}
  </style>
</head>
<body>
  <h1>GoodX Websites – SSL Certificate Expiry</h1>
<button onclick="loadData()" style="display:block; margin:20px auto; padding:10px 20px; background:#34495e; color:white; border:none; border-radius:5px; cursor:pointer;">Refresh Now</button>
  <table id="results">
    <thead>
      <tr>
        <th>Website</th>
        <th>Expiry Date</th>
        <th>Days Left</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <div class="refresh-time">Last updated: <span id="last-updated">—</span> • Auto-refreshes every 60 min</div>

  <script>
  const API_URL = "/.netlify/functions/check-ssls";

  async function loadData() {
    try {
      const res = await fetch(API_URL);
      if (!res.ok) {
        throw new Error(`API error: ${res.status}`);
      }
      const data = await res.json();
      console.log('Fetched data:', data);  // Debug: Check in browser console

      const tbody = document.getElementById("tbody");
      tbody.innerHTML = "";

      data.forEach(item => {
        const daysLeft = item.daysLeft;
        let statusClass = "status-ok";
        if (daysLeft === null || isNaN(daysLeft)) {
          statusClass = "status-danger";
        } else if (daysLeft < 0) {
          statusClass = "status-danger";
        } else if (daysLeft <= 30) {
          statusClass = "status-warning";
        }

        const row = document.createElement("tr");
        row.innerHTML = `
          <td data-label="Website"><a href="https://$$   {item.host}" target="_blank">   $${item.host}</a></td>
          <td data-label="Expiry">${item.validTo || "Error"}</td>
          <td data-label="Days Left" class="$$   {statusClass}">   $${daysLeft === null ? "—" : daysLeft}</td>
        `;
        tbody.appendChild(row);
      });

      document.getElementById("last-updated").textContent = new Date().toLocaleString();
    } catch (err) {
      console.error('Fetch error:', err);
      document.getElementById("tbody").innerHTML = `<tr><td colspan="3" style="text-align:center;color:#c0392b;">Error loading data: ${err.message} – try refreshing</td></tr>`;
    }
  }

  loadData();
  setInterval(loadData, 60 * 60 * 1000); // every hour
</script>
</body>
</html>
